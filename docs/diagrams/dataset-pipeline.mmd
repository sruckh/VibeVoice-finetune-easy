%% Dataset Preparation Pipeline
%% Date: 2026-02-12

flowchart TB
    classDef default fill:#e1f5fe,stroke:#0288d1,stroke-width:2px,color:#01579b
    classDef source fill:#e3f2fd,stroke:#0288d1,stroke-width:2px,color:#01579b
    classDef process fill:#fff3e0,stroke:#ef6c00,stroke-width:2px,color:#01579b
    classDef decision fill:#fff9c4,stroke:#f9a825,stroke-width:2px,color:#01579b
    classDef trans fill:#e8f5e9,stroke:#2e7d32,stroke-width:2px,color:#01579b
    classDef valid fill:#fce4ec,stroke:#c62828,stroke-width:2px,color:#01579b
    classDef output fill:#e8eaf6,stroke:#455a64,stroke-width:2px,color:#01579b

    S1["Raw Audio"]:::source
    S2["CSV"]:::source
    S3["Transcripts"]:::source
    P1["Scan"]:::process
    P2["Validate"]:::process
    T1{"Exists?"}:::decision
    T2["Existing"]:::trans
    T3["Whisper"]:::trans
    P3["Format"]:::process
    P4["Prompts"]:::process
    V1["Split"]:::valid
    O1["train.jsonl"]:::output
    O2["val.jsonl"]:::output

    S1 --> P1
    S2 --> P1
    S3 -.-> T2
    P1 --> P2 --> T1
    T1 -->|Yes| T2
    T1 -->|No| T3
    T2 & T3 --> P3 --> P4 --> V1
    V1 --> O1
    V1 --> O2
